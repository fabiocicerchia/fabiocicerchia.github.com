<VirtualHost *:80>
    ServerName   fabiocicerchia.github
    DocumentRoot /home/fabio/Web/fabiocicerchia.github.com/web

    #AddDefaultCharset UTF-8
    #DefaultLanguage   en-US
    SetEnv            TZ Europe/London

    # MIXED ###################################################################
    ServerSignature Off
    FileETag        MTime Size
    HostnameLookups Off
    TimeOut         300
    TraceEnable     Off

    # PROTECT FROM FLOOD
    LimitRequestBody 10485760

    # MISPELING ###############################################################
    <IfModule mod_speling.c>
        CheckSpelling On
    </IfModule>

    # LOG #####################################################################
    LogLevel  warn
    #<IfModule mod_perl.c>
    #    PerlWarn On
    #</IfModule>

    LogFormat "%h %l %u %t \"%r\" %>s %b" common
    LogFormat "\"%r\" %D"                 measure-time

    CustomLog /home/fabio/Web/fabiocicerchia.github.com/logs/access.log     common
    CustomLog /home/fabio/Web/fabiocicerchia.github.com/logs/slow_pages.log measure-time

    ErrorLog  /home/fabio/Web/fabiocicerchia.github.com/logs/error.log

    # SECURITY ################################################################
    <IfModule mod_security.c>
        SecFilterEngine On
        SecAuditEngine RelevantOnly

        SecFilterCheckURLEncoding On

        SecFilterCheckCookieFormat On

        SecAuditLog /home/fabio/Web/fabiocicerchia.github.com/logs/audit.log
        SecFilterDefaultAction "deny,log,auditlog,status:406"

        Include /home/fabio/Web/fabiocicerchia.github.com/web/modsecurity_crs_10_config.conf
        Include /home/fabio/Web/fabiocicerchia.github.com/lib/vendor/OWASP-CRS/base_rules/modsecurity_crs_20_protocol_violations.conf
        Include /home/fabio/Web/fabiocicerchia.github.com/lib/vendor/OWASP-CRS/base_rules/modsecurity_crs_21_protocol_anomalies.conf
        Include /home/fabio/Web/fabiocicerchia.github.com/lib/vendor/OWASP-CRS/base_rules/modsecurity_crs_40_generic_attacks.conf
        Include /home/fabio/Web/fabiocicerchia.github.com/lib/vendor/OWASP-CRS/base_rules/modsecurity_crs_42_tight_security.conf
        Include /home/fabio/Web/fabiocicerchia.github.com/lib/vendor/OWASP-CRS/base_rules/modsecurity_crs_41_sql_injection_attacks.conf
        Include /home/fabio/Web/fabiocicerchia.github.com/lib/vendor/OWASP-CRS/base_rules/modsecurity_crs_41_xss_attacks.conf
        Include /home/fabio/Web/fabiocicerchia.github.com/lib/vendor/OWASP-CRS/base_rules/modsecurity_crs_45_trojans.conf
    </IfModule>

    # DIRECTORIES #############################################################
    <Directory /home/fabio/Web/fabiocicerchia.github.com/web>
        Order allow,deny
        Allow from all
        AllowOverride None

        Options All -Indexes

        <IfModule mod_actions.c>
            # THE HEAD METHOD IS INCLUDED INTO GET
            # ALL HTTP METHODS: GET, POST, PUT, DELETE, CONNECT, OPTIONS,
            #                   PATCH, PROPFIND, PROPPATCH, MKCOL, COPY,
            #                   MOVE, LOCK, UNLOCK.
            # LIMIT THE HTTP METHODS ONLY TO REAL USED
            <LimitExcept GET POST>
                Order Deny,Allow
                Deny from all
            </LimitExcept>
        </IfModule>

        <IfModule mod_rewrite.c>
          RewriteEngine On

          RewriteBase /

          RewriteCond %{REQUEST_FILENAME} -s [OR]
          RewriteCond %{REQUEST_FILENAME} -l [OR]
          RewriteCond %{REQUEST_FILENAME} -d
          RewriteRule ^.+$               -                               [NC,L]

          RewriteRule ^minified/(.+\.css) minify/min/?f=$1 [L]
        </IfModule>
   </Directory>

   <Directory />
       AllowOverride None

       Options All -Indexes

        <IfModule mod_perl.c>
            #SetHandler perl-script
            AddHandler perl-script .pl
            PerlHandler ModPerl::Registry
            #PerlHandler ModPerl::PerlRun
            PerlSendHeader On
            Options +ExecCGI
        </IfModule>
   </Directory>

    #SetEnvIf Referer "^http:\/\/www.fabiocicerchia.it" local_referal
    #<Directory ~ /web/media>
    #    Order Deny,Allow
    #    Deny from all
    #    Allow from env=local_referal
    #</Directory>

    # CACHE ###################################################################
    <IfModule mod_cache.c>
        CacheDefaultExpire 3600
        CacheMaxExpire 86400

        # CacheDirLevels * CacheDirLength < 20
        <IfModule mod_disk_cache.c>
            CacheRoot /home/fabio/Web/fabiocicerchia.github.com/tmp/cache/apache
            CacheEnable disk /

            CacheDirLevels 5
            CacheDirLength 3

            CacheMinFileSize 1

            CacheIgnoreHeaders Set-Cookie
        </IfModule>

        # MCacheMaxObjectCount * MCacheMaxObjectSize = MAX MEMORY ALLOCATED
        <IfModule mod_mem_cache.c>
            CacheEnable mem /

            # 100MB
            MCacheSize 102400
            MCacheMaxObjectCount 512
            MCacheMinObjectSize 1
            MCacheMaxObjectSize 2048
        </IfModule>
    </IfModule>

    # EXPIRES #################################################################
#    <IfModule mod_expires.c>
#        ExpiresActive On
#
#        ExpiresByType image/x-icon             "access plus 1 month"
#        ExpiresByType image/gif                "access plus 1 month"
#        ExpiresByType image/jpeg               "access plus 1 month"
#        ExpiresByType image/png                "access plus 1 month"
#        ExpiresByType application/javascript   "access plus 2 week"
#        ExpiresByType application/x-javascript "access plus 2 week"
#        ExpiresByType text/css                 "access plus 2 week"
#    </IfModule>
#
    # PHP #####################################################################
    <IfModule mod_php5.c>
        php_value zlib.output_compression 16386
        php_flag  allow_url_fopen         Off
        php_flag  allow_url_include       Off
        php_flag  display_errors          Off
        php_flag  log_errors              On
        php_flag  expose_php              Off
        php_flag  file_uploads            Off
        php_flag  magic_quotes_gpc        Off
        php_value memory_limit            128M
        php_value post_max_size           256K
        php_flag  register_globals        Off
        php_value session.save_path       /home/fabio/Web/fabiocicerchia.github.com/tmp
        php_value upload_max_filesize     256K
        php_value upload_tmp_dir          /home/fabio/Web/fabiocicerchia.github.com/tmp
        php_flag  session.use_trans_sid   Off
    </IfModule>
</VirtualHost>
